<app-customer-list-filters
  [filters]="listFilters"
  [months]="months"
  [years]="years"
  [activeProductSegment]="activeProductSegment"
  [isExporting]="isExporting"
  (filterChange)="updateListFilter($event.key, $event.value)"
  (filterReset)="resetListFilter($event)"
  (productSegmentChange)="selectProductSegment($event)"
  (exportClick)="exportToExcel()"
></app-customer-list-filters>

<mat-card
  class="material-card list-card"
  role="region"
  aria-label="Customer list table"
>
  <div class="app-table-card">
    <mat-progress-bar *ngIf="isLoading" mode="indeterminate"></mat-progress-bar>
    <ng-container *ngIf="customerListData$ | async as customerListData">
      <div class="table-container app-table-container">
        <table
          mat-table
          [dataSource]="customerListData.rows"
          class="mat-elevation-z0 app-data-table"
        >
          <ng-container
            *ngFor="let column of columns"
            [matColumnDef]="column.key"
          >
            <th
              mat-header-cell
              *matHeaderCellDef
              scope="col"
              [class]="getSortClass(column)"
              [class.sortable]="column.sortable"
              [style.width]="column.width"
              [style.min-width]="column.width"
              (click)="onSort(column)"
            >
              <div class="header-content">
                <span class="header-text">{{ column.label }}</span>
                <mat-icon
                  *ngIf="column.sortable"
                  class="sort-icon"
                  [class.sort-active]="currentSort.field === column.sortField"
                >
                  {{ getSortIcon(column) }}
                </mat-icon>
              </div>
            </th>
            <td
              mat-cell
              *matCellDef="let row"
              [title]="getTooltip(row, column.key)"
              [style.width]="column.width"
              [style.min-width]="column.width"
            >
              {{ row[column.key] }}
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
          <tr class="mat-row" *matNoDataRow>
            <td class="empty-state" [attr.colspan]="displayedColumns.length">
              No customers found.
            </td>
          </tr>
        </table>
      </div>

      <app-pagination
        [paginationInfo]="customerListData.paginationInfo"
        [disabled]="isLoading"
        (pageChange)="onPageChange($event)"
      >
      </app-pagination>
    </ng-container>
  </div>
</mat-card>
