<!-- <div class="reports-toolbar">
  <button
    mat-raised-button
    color="primary"
    type="button"
    (click)="createReport()"
    [disabled]="creatingReport"
    [attr.aria-busy]="creatingReport"
  >
    <mat-icon aria-hidden="true" [class.spin-icon]="creatingReport">
      {{ creatingReport ? 'autorenew' : 'add' }}
    </mat-icon>
    <span>{{ creatingReport ? 'Creatingâ€¦' : 'Create Report' }}</span>
  </button>
</div> -->

<section class="table-card app-table-card">
  <div class="table-container app-table-container">
    <table class="reports-table app-data-table" role="table">
      <thead>
        <tr>
          <th scope="col" class="col-report">
            <button type="button" class="header-cell sort-button" (click)="changeSort('name')">
              <span>Report Name</span>
              <mat-icon aria-hidden="true">{{ sortIcon('name') }}</mat-icon>
            </button>
          </th>
          <!-- <th scope="col">Total Bid Volume</th> -->
          <th scope="col">
            <button type="button" class="header-cell sort-button" (click)="changeSort('totalBidVolumePr')">
              <span>Total Bid Volume (Propane)</span>
              <mat-icon aria-hidden="true">{{ sortIcon('totalBidVolumePr') }}</mat-icon>
            </button>
          </th>
          <th scope="col">
            <button type="button" class="header-cell sort-button" (click)="changeSort('totalBidVolumePp')">
              <span>Total Bid Volume for Butane</span>
              <mat-icon aria-hidden="true">{{ sortIcon('totalBidVolumePp') }}</mat-icon>
            </button>
          </th>
          <th scope="col">
            <button type="button" class="header-cell sort-button" (click)="changeSort('weightedAvgPr')">
              <span>Weighted Average for Propane</span>
              <mat-icon aria-hidden="true">{{ sortIcon('weightedAvgPr') }}</mat-icon>
            </button>
          </th>
          <th scope="col">
            <button type="button" class="header-cell sort-button" (click)="changeSort('weightedAvgPp')">
              <span>Weighted Average for Butane</span>
              <mat-icon aria-hidden="true">{{ sortIcon('weightedAvgPp') }}</mat-icon>
            </button>
          </th>
          <th scope="col">
            <button type="button" class="header-cell sort-button" (click)="changeSort('month')">
              <span>Month</span>
              <mat-icon aria-hidden="true">{{ sortIcon('month') }}</mat-icon>
            </button>
          </th>
          <th scope="col">
            <button type="button" class="header-cell sort-button" (click)="changeSort('year')">
              <span>Year</span>
              <mat-icon aria-hidden="true">{{ sortIcon('year') }}</mat-icon>
            </button>
          </th>
          <th scope="col">Past History Analysis</th>
          <th scope="col">Approvers History</th>
          <th scope="col">
            <button type="button" class="header-cell sort-button" (click)="changeSort('status')">
              <span>Status</span>
              <mat-icon aria-hidden="true">{{ sortIcon('status') }}</mat-icon>
            </button>
          </th>
          <th scope="col">
            <button type="button" class="header-cell sort-button" (click)="changeSort('exception')">
              <span>Exception</span>
              <mat-icon aria-hidden="true">{{ sortIcon('exception') }}</mat-icon>
            </button>
          </th>
          <th scope="col" *ngIf="showDeleteColumn">Delete</th>
          <th scope="col">Export to PDF</th>
        </tr>
      </thead>
      <tbody *ngIf="reports$ | async as reports; else emptyState">
        <tr
          *ngFor="let row of reports; trackBy: trackByReportId"
          class="reports-row"
        >
          <td data-label="Report Name">
            <button
              mat-button
              type="button"
              class="link-button"
              (click)="openReportDetails(row)"
            >
              {{ row.name }}
            </button>
          </td>
          <!-- <td data-label="Total Volume">{{ row.totalBidVolume | number: '1.0-0' }}</td> -->
          <td data-label="Total Bid Volume (Propane)">{{ row.totalBidVolumePr | number: '1.0-0' }}</td>
          <td data-label="Total Bid Volume for Butane">{{ row.totalBidVolumePp | number: '1.0-0' }}</td>
          <td data-label="Weighted Average for Propane">{{ row.weightedAvgPr | number: '1.2-2' }}</td>
          <td data-label="Weighted Average for Butane">{{ row.weightedAvgPp | number: '1.2-2' }}</td>
          <td data-label="Month">{{ row.month }}</td>
          <td data-label="Year">{{ row.year }}</td>
          <td data-label="Past History Analysis">
            <button
              mat-stroked-button
              type="button"
              (click)="openReportHistory(row, $event)"
              [disabled]="isAnyActionInProgress(row.id)"
            >
              View History
            </button>
          </td>
          <td data-label="Approvers History">
            <button
              mat-stroked-button
              class="reset-default-button"
              type="button"
              (click)="openApprovalHistory(row, row.exception, $event)"
              [disabled]="isAnyActionInProgress(row.id) || isApprovalHistoryLoading(row.id)"
            >
              <img [src]="icons.approvalHistory" alt="Approval History" />
            </button>
          </td>
          <td data-label="Status">
            <span [ngClass]="statusClass(row.status)">{{ row.status }}</span>
          </td>
          <td data-label="Exception">
            <ng-container *ngIf="!row.exception; else exceptionBadge">
              <span
                class="exception-tooltip-wrapper"
                [matTooltip]="getExceptionTooltip(row)"
                matTooltipPosition="above"
              >
              <button
                type="button"
                class="exception-button"
                (click)="createExceptionReport(row, $event)"
                [disabled]="
                  isReadOnlyView ||
                  isExceptionProcessing(row.id) ||
                  isActiveStatus(row.status)
                "
              >
                  <mat-icon *ngIf="isExceptionProcessing(row.id)" class="exception-spinner" aria-hidden="true">autorenew</mat-icon>
                  <span *ngIf="!isExceptionProcessing(row.id)">Create</span>
                </button>
              </span>
            </ng-container>
            <ng-template #exceptionBadge>
              <span [ngClass]="exceptionClass(row.exception)">Exception</span>
            </ng-template>
          </td>
          <td data-label="Delete" *ngIf="showDeleteColumn">
            <button
              type="button"
              class="delete"
              aria-label="Delete report"
              (click)="deleteReport(row, $event)"
              [matTooltip]="deleteTooltip(row)"
              [class.delete--disabled]="isReadOnlyView || !canDeleteReport(row.status)"
              [attr.aria-disabled]="isReadOnlyView || !canDeleteReport(row.status)"
              [class.delete--loading]="isDeleting(row.id)"
            >
              <mat-icon *ngIf="isDeleting(row.id)" class="delete-spinner" aria-hidden="true">autorenew</mat-icon>
              <img *ngIf="!isDeleting(row.id)" class="ico" [src]="icons.delete" alt="Delete" />
            </button>
          </td>
          <td data-label="Export to PDF">
            <button
              type="button"
              class="reset-default-button"
              aria-label="Export report to PDF"
              (click)="exportReportToPDF(row, $event)"
              [matTooltip]="'Export to PDF'"
              [class.export-pdf--loading]="isExporting(row.id)"
            >
              <mat-icon *ngIf="isExporting(row.id)" class="export-pdf-spinner" aria-hidden="true">autorenew</mat-icon>
              <img *ngIf="!isExporting(row.id)" [src]="icons.exportPdf" alt="Export to PDF" />
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</section>

<ng-container *ngIf="reports$ | async as reports">
  <footer class="reports-footer">
    Showing {{ reports.length }} records for {{ selectedMonth }} {{ selectedYear }}
  </footer>
</ng-container>

<ng-template #emptyState>
  <tbody>
    <tr>
      <td colspan="12" class="empty-state">No reports available.</td>
    </tr>
  </tbody>
</ng-template>
