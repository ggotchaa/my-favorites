<section class="table-card app-table-card">
  <div class="table-container app-table-container">
    <table class="reports-table app-data-table" role="table">
      <thead>
        <tr>
          <th scope="col" class="col-report">
            <div class="header-cell">
              <span>Report Name</span>
              <mat-icon aria-hidden="true">unfold_more</mat-icon>
            </div>
          </th>
          <th scope="col">Total Bid Volume</th>
          <th scope="col">Total Bid Volume PR</th>
          <th scope="col">Total Bid Volume PT</th>
          <th scope="col">Weighted Avg PR</th>
          <th scope="col">Weighted Avg BT</th>
          <th scope="col">Month</th>
          <th scope="col">Year</th>
          <th scope="col">Past History Analysis</th>
          <th scope="col">Report File</th>
          <th scope="col">Status</th>
          <th scope="col">Lock</th>
          <th scope="col">Exception</th>
          <th scope="col">Delete</th>
        </tr>
      </thead>
      <tbody *ngIf="reports$ | async as reports; else emptyState">
        <tr
          *ngFor="let row of reports; trackBy: trackByReportId"
          class="reports-row"
        >
          <td data-label="Report Name">
            <button
              mat-button
              type="button"
              class="link-button"
              (click)="openReportDetails(row)"
            >
              {{ row.name }}
            </button>
          </td>
          <td data-label="Total Volume">{{ row.totalBidVolume | number: '1.0-0' }}</td>
          <td data-label="Total Propane Volume">{{ row.totalBidVolumePr | number: '1.0-0' }}</td>
          <td data-label="Total Butane Volume">{{ row.totalBidVolumePp | number: '1.0-0' }}</td>
          <td data-label="Weighted Avg Propane Price">{{ row.weightedAvgPr | number: '1.2-2' }}</td>
          <td data-label="Weighted Avg Butane Price">{{ row.weightedAvgPp | number: '1.2-2' }}</td>
          <td data-label="Month">{{ row.month }}</td>
          <td data-label="Year">{{ row.year }}</td>
          <td data-label="Past History Analysis">
            <div class="history-links">
              <ng-container *ngIf="row.historyFiles.length; else noHistory">
                <a
                  *ngFor="let file of row.historyFiles; let i = index"
                  mat-button
                  class="link-button"
                  [href]="file"
                  target="_blank"
                  rel="noopener"
                  (click)="$event.stopPropagation()"
                >
                  History {{ i + 1 }}
                </a>
              </ng-container>
              <ng-template #noHistory>
                <span>No history</span>
              </ng-template>
            </div>
          </td>
          <td data-label="Report">
            <div class="buttons">
              <a
                class="icon-btn"
                [href]="row.reportLink"
                target="_blank"
                rel="noopener"
                [attr.aria-label]="'Download ' + row.reportFile"
                (click)="$event.stopPropagation()"
              >
                <img class="ico ico-download" [src]="icons.download" [attr.alt]="'Download ' + row.reportFile" />
              </a>
              <a
                class="icon-btn"
                [href]="row.reportLink"
                target="_blank"
                rel="noopener"
                [attr.aria-label]="'Preview ' + row.reportFile"
                (click)="$event.stopPropagation()"
              >
                <img class="ico ico-file" [src]="icons.preview" [attr.alt]="'Preview ' + row.reportFile" />
              </a>
            </div>
          </td>
          <td data-label="Status">
            <span [ngClass]="statusClass(row.status)">{{ row.status }}</span>
          </td>
          <td data-label="Lock">
            <span class="lock" [attr.aria-label]="row.locked ? 'Locked' : 'Unlocked'">
              <img
                class="ico"
                [src]="row.locked ? icons.lock : icons.unlock"
                [attr.alt]="row.locked ? 'Locked' : 'Unlocked'"
              />
            </span>
          </td>
          <td data-label="Exception">
            <span [ngClass]="exceptionClass(row.exception)">
              {{ row.exception ? 'Exception' : 'None' }}
            </span>
          </td>
          <td data-label="Delete">
            <button
              type="button"
              class="delete"
              aria-label="Delete report"
              (click)="$event.stopPropagation()"
            >
              <img class="ico" [src]="icons.delete" alt="Delete" />
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</section>

<ng-container *ngIf="reports$ | async as reports">
  <footer class="reports-footer">
    Showing {{ reports.length }} records for {{ selectedMonth }} {{ selectedYear }}
  </footer>
</ng-container>

<ng-template #emptyState>
  <tbody>
    <tr>
      <td colspan="14" class="empty-state">No reports available.</td>
    </tr>
  </tbody>
</ng-template>
