<div class="reports-toolbar">
  <button
    mat-raised-button
    color="primary"
    type="button"
    (click)="createReport()"
    [disabled]="creatingReport"
    [attr.aria-busy]="creatingReport"
  >
    <mat-icon aria-hidden="true" [class.spin-icon]="creatingReport">
      {{ creatingReport ? 'autorenew' : 'add' }}
    </mat-icon>
    <span>{{ creatingReport ? 'Creatingâ€¦' : 'Create Report' }}</span>
  </button>
</div>

<section class="table-card app-table-card">
  <div class="table-container app-table-container">
    <table class="reports-table app-data-table" role="table">
      <thead>
        <tr>
          <th scope="col" class="col-report">
            <div class="header-cell">
              <span>Report Name</span>
              <mat-icon aria-hidden="true">unfold_more</mat-icon>
            </div>
          </th>
          <th scope="col">Total Bid Volume</th>
          <th scope="col">Total Bid Volume PR</th>
          <th scope="col">Total Bid Volume PT</th>
          <th scope="col">Weighted Avg PR</th>
          <th scope="col">Weighted Avg BT</th>
          <th scope="col">Month</th>
          <th scope="col">Year</th>
          <th scope="col">Past History Analysis</th>
          <th scope="col">Approval History</th>
          <th scope="col">Status</th>
          <th scope="col">Exception</th>
          <th scope="col">Delete</th>
        </tr>
      </thead>
      <tbody *ngIf="reports$ | async as reports; else emptyState">
        <tr
          *ngFor="let row of reports; trackBy: trackByReportId"
          class="reports-row"
        >
          <td data-label="Report Name">
            <button
              mat-button
              type="button"
              class="link-button"
              (click)="openReportDetails(row)"
            >
              {{ row.name }}
            </button>
          </td>
          <td data-label="Total Volume">{{ row.totalBidVolume | number: '1.0-0' }}</td>
          <td data-label="Total Propane Volume">{{ row.totalBidVolumePr | number: '1.0-0' }}</td>
          <td data-label="Total Butane Volume">{{ row.totalBidVolumePp | number: '1.0-0' }}</td>
          <td data-label="Weighted Avg Propane Price">{{ row.weightedAvgPr | number: '1.2-2' }}</td>
          <td data-label="Weighted Avg Butane Price">{{ row.weightedAvgPp | number: '1.2-2' }}</td>
          <td data-label="Month">{{ row.month }}</td>
          <td data-label="Year">{{ row.year }}</td>
          <td data-label="Past History Analysis">
            <button
              mat-stroked-button
              type="button"
              (click)="openReportHistory(row, $event)"
              [disabled]="isReportProcessing(row.id)"
            >
              View History
            </button>
          </td>
          <td data-label="Approval History">
            <button
              mat-stroked-button
              type="button"
              (click)="openApprovalHistory(row, $event)"
              [disabled]="isReportProcessing(row.id)"
            >
              View Approvers
            </button>
          </td>
          <td data-label="Status">
            <span [ngClass]="statusClass(row.status)">{{ row.status }}</span>
          </td>
          <td data-label="Exception">
            <button
              *ngIf="!row.exception; else exceptionBadge"
              type="button"
              class="exception-button"
              (click)="createExceptionReport(row, $event)"
              [disabled]="isReportProcessing(row.id)"
              matTooltip="Create exception report"
            >
              <mat-icon *ngIf="isReportProcessing(row.id)" class="exception-spinner" aria-hidden="true">autorenew</mat-icon>
              <span *ngIf="!isReportProcessing(row.id)">Create</span>
            </button>
            <ng-template #exceptionBadge>
              <span [ngClass]="exceptionClass(row.exception)">Exception</span>
            </ng-template>
          </td>
          <td data-label="Delete">
            <button
              type="button"
              class="delete"
              aria-label="Delete report"
              (click)="deleteReport(row, $event)"
              [matTooltip]="deleteTooltip(row)"
              [class.delete--disabled]="!canDeleteReport(row.status)"
              [attr.aria-disabled]="!canDeleteReport(row.status)"
              [class.delete--loading]="isReportProcessing(row.id)"
            >
              <mat-icon *ngIf="isReportProcessing(row.id)" class="delete-spinner" aria-hidden="true">autorenew</mat-icon>
              <img *ngIf="!isReportProcessing(row.id)" class="ico" [src]="icons.delete" alt="Delete" />
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</section>

<ng-container *ngIf="reports$ | async as reports">
  <footer class="reports-footer">
    Showing {{ reports.length }} records for {{ selectedMonth }} {{ selectedYear }}
  </footer>
</ng-container>

<ng-template #emptyState>
  <tbody>
    <tr>
      <td colspan="13" class="empty-state">No reports available.</td>
    </tr>
  </tbody>
</ng-template>
