<section class="report-details">
  <button type="button" mat-stroked-button class="back-button" (click)="backToReports()">
    <mat-icon aria-hidden="true">arrow_back</mat-icon>
    <span>Back to Reports</span>
  </button>

  <mat-card class="material-card report-summary-card" *ngIf="reportSummary as summary">
    <div class="summary-header">
      <h2>{{ summary.reportName || 'Bidding Report Details' }}</h2>
      <div class="summary-meta">
        <span>{{ summary.reportMonth }} {{ summary.reportYear }}</span>
        <span class="status-badge" [ngClass]="statusClass(summary.status)">{{ summary.status }}</span>
      </div>
    </div>
    <div class="summary-grid">
      <div class="summary-item">
        <span class="summary-label">Total Butane Volume</span>
        <span class="summary-value">{{ summary.totalButaneVolume | number: '1.0-0' }}</span>
      </div>
      <div class="summary-item">
        <span class="summary-label">Total Propane Volume</span>
        <span class="summary-value">{{ summary.totalPropaneVolume | number: '1.0-0' }}</span>
      </div>
      <div class="summary-item">
        <span class="summary-label">Weighted Avg Butane Price</span>
        <span class="summary-value">{{ summary.weightedAvgButanePrice | number: '1.2-2' }}</span>
      </div>
      <div class="summary-item">
        <span class="summary-label">Weighted Avg Propane Price</span>
        <span class="summary-value">{{ summary.weightedAvgPropanePrice | number: '1.2-2' }}</span>
      </div>
      <div class="summary-item">
        <span class="summary-label">Weighted Total Price</span>
        <span class="summary-value">
          {{ summary.weightedTotalPrice === null ? '—' : (summary.weightedTotalPrice | number: '1.2-2') }}
        </span>
      </div>
      <div class="summary-item">
        <span class="summary-label">Total Volume</span>
        <span class="summary-value">{{ summary.totalVolume | number: '1.0-0' }}</span>
      </div>
    </div>
  </mat-card>

  <mat-card class="material-card summary-table-card" *ngIf="hasSummaries">
    <h3>Report Summary</h3>
    <table class="summary-table">
      <tbody>
        <tr *ngFor="let item of summaries">
          <th scope="row">{{ item.caption }}</th>
          <td>{{ item.value || '—' }}</td>
        </tr>
      </tbody>
    </table>
  </mat-card>

  <ng-container *ngIf="!isLoading && !hasError; else detailsState">
    <mat-card class="material-card details-card">
      <div class="product-tables" *ngIf="hasAwardData; else emptyState">
        <section class="product-table" *ngIf="awardTables.propane.dataSource.data.length">
          <h3 class="product-table__title">{{ awardTables.propane.label }}</h3>
          <div class="table-container app-table-container">
            <table
              mat-table
              [dataSource]="awardTables.propane.dataSource"
              class="app-data-table mat-elevation-z0"
              matSort
              #propaneSort="matSort"
            >
              <ng-container *ngFor="let column of awardsColumns" [matColumnDef]="column.key">
                <th mat-header-cell *matHeaderCellDef [mat-sort-header]="column.key">{{ column.label }}</th>
                <td mat-cell *matCellDef="let row">
                  <ng-container [ngSwitch]="column.key">
                    <span *ngSwitchCase="'status'" class="status-badge" [ngClass]="statusClass(row[column.key])">
                      {{ row[column.key] }}
                    </span>
                    <span *ngSwitchCase="'bidVolume'">{{ row[column.key] | number: '1.0-0' }}</span>
                    <span *ngSwitchCase="'awardedVolume'">{{ row[column.key] | number: '1.0-0' }}</span>
                    <span *ngSwitchCase="'finalAwardedVolume'">{{ row[column.key] | number: '1.0-0' }}</span>
                    <span *ngSwitchCase="'bidPrice'">{{ row[column.key] | number: '1.2-2' }}</span>
                    <span *ngSwitchCase="'differentialPrice'">{{ row[column.key] | number: '1.2-2' }}</span>
                    <span *ngSwitchCase="'rankPerPrice'">{{ row[column.key] | number: '1.0-0' }}</span>
                    <span *ngSwitchCase="'rollingLiftFactor'">{{ row[column.key] | number: '1.2-2' }}</span>
                    <span *ngSwitchCase="'comments'">
                      {{ row[column.key] || '—' }}
                    </span>
                    <span *ngSwitchDefault>{{ valueFor(row, column.key) }}</span>
                  </ng-container>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="awardsDisplayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: awardsDisplayedColumns; trackBy: trackDetail"></tr>
            </table>
          </div>
        </section>

        <section class="product-table" *ngIf="awardTables.butane.dataSource.data.length">
          <h3 class="product-table__title">{{ awardTables.butane.label }}</h3>
          <div class="table-container app-table-container">
            <table
              mat-table
              [dataSource]="awardTables.butane.dataSource"
              class="app-data-table mat-elevation-z0"
              matSort
              #butaneSort="matSort"
            >
              <ng-container *ngFor="let column of awardsColumns" [matColumnDef]="column.key">
                <th mat-header-cell *matHeaderCellDef [mat-sort-header]="column.key">{{ column.label }}</th>
                <td mat-cell *matCellDef="let row">
                  <ng-container [ngSwitch]="column.key">
                    <span *ngSwitchCase="'status'" class="status-badge" [ngClass]="statusClass(row[column.key])">
                      {{ row[column.key] }}
                    </span>
                    <span *ngSwitchCase="'bidVolume'">{{ row[column.key] | number: '1.0-0' }}</span>
                    <span *ngSwitchCase="'awardedVolume'">{{ row[column.key] | number: '1.0-0' }}</span>
                    <span *ngSwitchCase="'finalAwardedVolume'">{{ row[column.key] | number: '1.0-0' }}</span>
                    <span *ngSwitchCase="'bidPrice'">{{ row[column.key] | number: '1.2-2' }}</span>
                    <span *ngSwitchCase="'differentialPrice'">{{ row[column.key] | number: '1.2-2' }}</span>
                    <span *ngSwitchCase="'rankPerPrice'">{{ row[column.key] | number: '1.0-0' }}</span>
                    <span *ngSwitchCase="'rollingLiftFactor'">{{ row[column.key] | number: '1.2-2' }}</span>
                    <span *ngSwitchCase="'comments'">
                      {{ row[column.key] || '—' }}
                    </span>
                    <span *ngSwitchDefault>{{ valueFor(row, column.key) }}</span>
                  </ng-container>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="awardsDisplayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: awardsDisplayedColumns; trackBy: trackDetail"></tr>
            </table>
          </div>
        </section>
      </div>
    </mat-card>
  </ng-container>

  <ng-template #detailsState>
    <mat-card class="material-card details-card">
      <div class="state-message" *ngIf="isLoading">Loading bidding report details…</div>
      <div class="state-message state-message--error" *ngIf="hasError && !isLoading">
        Unable to load bidding report details.
      </div>
    </mat-card>
  </ng-template>

  <ng-template #emptyState>
    <div class="state-message">No award data available for this report.</div>
  </ng-template>
</section>
