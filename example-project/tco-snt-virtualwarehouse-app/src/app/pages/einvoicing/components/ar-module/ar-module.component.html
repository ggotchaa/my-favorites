<div fxLayout="column">

  <div fxLayout="row" fxLayoutAlign="start center" fxFlexOffset="10px">
    <button *ngIf="this.hasAccess(this.eiArAccessControlList.get('new'))"
      class="primary-color hidden"
      mat-raised-button
      [routerLink]="['/einvoicing/new']">
      Создание счета-фактуры
  </button>
  </div>

  <app-filter (filterOutput)="onFilterOutputChange($event)" fxFlexOffset="10px"></app-filter>
  <app-report></app-report>
  <div fxLayout="row"  style="background-color: white;" >
    <app-last-sync-dates fxLayoutAlign="left center"></app-last-sync-dates>
    <mat-paginator [length]="resultsLength" [pageSize]="15" [pageSizeOptions]="pageSizeOptions" [showFirstLastButtons]="true" fxFlex="auto"></mat-paginator>
  </div>  

  <table mat-table [dataSource]="dataSource" multiTemplateDataRows class="mat-elevation-z8">

    <ng-container matColumnDef="jdeType">
      <th scope="col" id="" mat-header-cell *matHeaderCellDef>Last Inv Type</th>
      <td mat-cell *matCellDef="let element">{{element.jdeType}}</td>
    </ng-container>    
    <ng-container matColumnDef="jdeNumber">
      <th scope="col" mat-header-cell *matHeaderCellDef>Invoice Number</th>
      <td mat-cell *matCellDef="let element">{{element.jdeNumber}}</td>
    </ng-container>
    <ng-container matColumnDef="jdeLastUpdatedDate">
      <th scope="col" mat-header-cell *matHeaderCellDef>Last Inv Date</th>
      <td mat-cell *matCellDef="let element"> {{element.jdeLastUpdatedDate| date: 'dd/MM/yyyy'}} </td>
    </ng-container>
    <ng-container matColumnDef="jdeIinBin">
      <th scope="col" mat-header-cell *matHeaderCellDef>Customer IIN/BIN</th>
      <td mat-cell *matCellDef="let element"> {{element.jdeIinBin}} </td>
    </ng-container>
    <ng-container matColumnDef="jdeCustomer">
      <th scope="col" mat-header-cell *matHeaderCellDef>Customer Name</th>
      <td mat-cell *matCellDef="let element"> {{element.jdeCustomer}} </td>
    </ng-container>
    <ng-container matColumnDef="jdeContractNumber">
      <th scope="col" mat-header-cell *matHeaderCellDef>Contract #</th>
      <td mat-cell *matCellDef="let element"> {{element.jdeContractNumber}} </td>
    </ng-container>
    <ng-container matColumnDef="jdeContractDate">
      <th scope="col" mat-header-cell *matHeaderCellDef>Contract Date</th>
      <td mat-cell *matCellDef="let element"> {{element.jdeContractDate | date: 'dd/MM/yyyy'}} </td>
    </ng-container>
    <ng-container matColumnDef="jdeCurrency">
      <th scope="col" mat-header-cell *matHeaderCellDef>Currency</th>
      <td mat-cell *matCellDef="let element"> {{element.jdeCurrency}} </td>
    </ng-container>
    <ng-container matColumnDef="jdeTaxableAmount">
      <th scope="col" mat-header-cell *matHeaderCellDef>Values of Taxable</th>
      <td mat-cell *matCellDef="let element"> {{element.jdeTaxableAmount}} </td>
    </ng-container>
    <ng-container matColumnDef="jdeTaxAmount">
      <th scope="col" mat-header-cell *matHeaderCellDef>Tax Amounts</th>
      <td mat-cell *matCellDef="let element"> {{element.jdeTaxAmount}} </td>
    </ng-container>
    <ng-container matColumnDef="jdeGrossAmount">
      <th scope="col" mat-header-cell *matHeaderCellDef class="delimiter-col">Inv Amount</th>
      <td mat-cell *matCellDef="let element"> {{element.jdeGrossAmount}} </td>
    </ng-container>

    <ng-container matColumnDef="esfType">
      <th scope="col" mat-header-cell *matHeaderCellDef>Last Inv Type</th>
      <td mat-cell *matCellDef="let element">{{element.esfType}}</td>
    </ng-container>
    <ng-container matColumnDef="esfStatus">
      <th scope="col" mat-header-cell *matHeaderCellDef>Last Inv Status</th>
      <td mat-cell *matCellDef="let element"> {{element.esfStatus}} </td>
    </ng-container>    
    <ng-container matColumnDef="esfNumber">
      <th scope="col" mat-header-cell *matHeaderCellDef>Invoice Number</th>
      <td mat-cell *matCellDef="let element"> {{element.esfNumber}}</td>
    </ng-container>
    <ng-container matColumnDef="esfLastUpdatedDate">
      <th scope="col" mat-header-cell *matHeaderCellDef>Last Inv Date</th>
      <td mat-cell *matCellDef="let element"> {{element.esfLastUpdatedDate | date: 'dd/MM/yyyy'}} </td>
    </ng-container>
    <ng-container matColumnDef="esfIinBin">
      <th scope="col" mat-header-cell *matHeaderCellDef>Customer IIN/BIN</th>
      <td mat-cell *matCellDef="let element"> {{element.esfIinBin}} </td>
    </ng-container>
    <ng-container matColumnDef="esfCustomer">
      <th scope="col" mat-header-cell *matHeaderCellDef>Customer Name</th>
      <td mat-cell *matCellDef="let element"> {{element.esfCustomer}} </td>
    </ng-container>
    <ng-container matColumnDef="esfContractNumber">
      <th scope="col" mat-header-cell *matHeaderCellDef>Contract #</th>
      <td mat-cell *matCellDef="let element"> {{element.esfContractNumber}} </td>
    </ng-container>
    <ng-container matColumnDef="esfContractDate">
      <th scope="col" mat-header-cell *matHeaderCellDef>Contract Date</th>
      <td mat-cell *matCellDef="let element"> {{element.esfContractDate| date: 'dd/MM/yyyy'}} </td>
    </ng-container>
    <ng-container matColumnDef="esfCurrency">
      <th scope="col" mat-header-cell *matHeaderCellDef>Currency</th>
      <td mat-cell *matCellDef="let element"> {{element.esfCurrency}} </td>
    </ng-container>
    <ng-container matColumnDef="esfTaxableAmount">
      <th scope="col" mat-header-cell *matHeaderCellDef>Values of Taxable</th>
      <td mat-cell *matCellDef="let element"> {{element.esfTaxableAmount}} </td>
    </ng-container>
    <ng-container matColumnDef="esfTaxAmount">
      <th scope="col" mat-header-cell *matHeaderCellDef>Tax Amounts</th>
      <td mat-cell *matCellDef="let element"> {{element.esfTaxAmount}} </td>
    </ng-container>
    <ng-container matColumnDef="esfGrossAmount">
      <th scope="col" mat-header-cell *matHeaderCellDef>Inv Amount</th>
      <td mat-cell *matCellDef="let element"> {{element.esfGrossAmount}} </td>
    </ng-container>

    <!--<ng-container matColumnDef="referenceComment">
      <th mat-header-cell *matHeaderCellDef>Accountant comment</th>
      <td mat-cell *matCellDef="let element"></td>
    </ng-container>
    <ng-container matColumnDef="reconcileComment">
      <th mat-header-cell *matHeaderCellDef> Reconcile Comment</th>
      <td mat-cell *matCellDef="let element"> </td>
    </ng-container>-->

    <ng-container matColumnDef="expandedDetail">
      <td mat-cell *matCellDef="let element" [attr.colspan]="columnsToDisplay.length">
        <div class="example-element-detail" [@detailExpand]="element.expanded && element.esfJdeArMatchItems ? 'expanded' : 'collapsed'">
          <table class="details-table mat-table m-1">
            <thead>
              <tr class="mat-row">
                <th scope="col" [attr.colspan]="12">JDE</th>
                <th scope="col" [attr.colspan]="14">ESF</th>
              </tr>
              <tr class="mat-row">
                <th scope="col" class="mat-cell">Inv Type</th>
                <th scope="col" class="mat-cell">Inv Date</th>
                <th scope="col" class="mat-cell">Inv Turnover Date</th>
                <th scope="col" class="mat-cell">Invoice Number</th>
                <th scope="col" class="mat-cell">Customer IIN/BIN</th>
                <th scope="col" class="mat-cell">Customer Name</th>
                <th scope="col" class="mat-cell">Contract #</th>
                <th scope="col" class="mat-cell">Contract Date</th>
                <th scope="col" class="mat-cell">Currency</th>
                <th scope="col" class="mat-cell">Values of Taxable</th>
                <th scope="col" class="mat-cell">Tax Amounts</th>
                <th scope="col" class="mat-cell">Inv Amount</th>

                <th scope="col" class="mat-cell">Inv Type</th>
                <th scope="col" class="mat-cell">Inv Status</th>
                <th scope="col" class="mat-cell">Inv Date</th>
                <th scope="col" class="mat-cell">Inv Turnover Date</th>
                <th scope="col" class="mat-cell">Invoice Number</th>
                <th scope="col" class="mat-cell">Registration Number</th>
                <th scope="col" class="mat-cell">Customer IIN/BIN</th>
                <th scope="col" class="mat-cell">Customer Name</th>
                <th scope="col" class="mat-cell">Contract #</th>
                <th scope="col" class="mat-cell">Contract Date</th>
                <th scope="col" class="mat-cell">Currency</th>
                <th scope="col" class="mat-cell">Values of Taxable</th>
                <th scope="col" class="mat-cell">Tax Amounts</th>
                <th scope="col" class="mat-cell">Inv Amount</th>

              </tr>
          </thead>
            <tbody>
             
              <tr class="mat-row" *ngFor="let item of element.esfJdeArMatchItems">
                <td class="mat-cell">{{item.jdeType}}</td>
                <td class="mat-cell">{{item.jdeDate | date: 'dd/MM/yyyy'}}</td>
                <td class="mat-cell">{{item.jdeTurnoverDate | date: 'dd/MM/yyyy'}}</td>
                <td class="mat-cell">
                  <a [routerLink]="['/einvoicing/edit', item.jdeNumber,item.jdeType,item.jdeInvoiceId]"> {{item.jdeNumber}}</a>
                  <ng-template #documentNumberDisplay>{{item.jdeNumber}}</ng-template>
                  <br>
                  <span *ngIf="item.invoiceStatus === InvoiceStatus.DRAFT"><strong>DRAFT</strong></span>
                </td>
                <td class="mat-cell">{{item.jdeIinBin}}</td>
                <td class="mat-cell">{{item.jdeCustomer}}</td>
                <td class="mat-cell">{{item.jdeContractNumber}}</td>
                <td class="mat-cell">{{item.jdeContractDate | date: 'dd/MM/yyyy'}}</td>
                <td class="mat-cell">{{item.jdeCurrency}}</td>
                <td class="mat-cell">{{item.jdeTaxableAmount}}</td>
                <td class="mat-cell">{{item.jdeTaxAmount}}</td>
                <td class="mat-cell">{{item.jdeGrossAmount}}</td>

                <td class="mat-cell">{{item.esfType}}</td>
                <td class="mat-cell">{{item.esfStatus}}</td>
                <td class="mat-cell">{{item.esfDate | date: 'dd/MM/yyyy'}}</td>
                <td class="mat-cell">{{item.esfTurnoverDate | date: 'dd/MM/yyyy'}}</td>
                <td class="mat-cell">
                  <a [routerLink]="['/einvoicing/read', item.esfInvoiceId]"> {{item.esfNumber}}</a>
                </td>
                <td class="mat-cell">{{item.esfRegistrationNumber}}</td>
                <td class="mat-cell">{{item.esfIinBin}}</td>
                <td class="mat-cell">{{item.esfCustomer}}</td>
                <td class="mat-cell">{{item.esfContractNumber}}</td>
                <td class="mat-cell">{{item.esfContractDate | date: 'dd/MM/yyyy'}}</td>
                <td class="mat-cell">{{item.esfCurrency}}</td>
                <td class="mat-cell">{{item.esfTaxableAmount}}</td>
                <td class="mat-cell">{{item.esfTaxAmount}}</td>
                <td class="mat-cell">{{item.esfGrossAmount}}</td>
                <!--<td class="mat-cell">
    Reference comment
    <div class="">
      <button class="mat-icon-button-table-edit" mat-icon-button (click)="openDialog(item)">
        <mat-icon class="mat-icon-table-edit">edit</mat-icon>
      </button>
    </div>
  </td>
  <td class="mat-cell">
    Reconcile comment
    <div class="">
      <button class="mat-icon-button-table-edit" mat-icon-button (click)="openDialog(item)">
        <mat-icon class="mat-icon-table-edit">edit</mat-icon>
      </button>
    </div>
  </td>-->
              </tr>
            </tbody>
          </table>
        </div>
      </td>
    </ng-container>

    <ng-container matColumnDef="header-row-jde-group">
      <th scope="col" mat-header-cell *matHeaderCellDef [style.text-align]="center" class="delimiter-col" [attr.colspan]="11">JDE</th>
    </ng-container>

    <ng-container matColumnDef="header-row-esf-group">
      <th scope="col" mat-header-cell *matHeaderCellDef [style.text-align]="center" [attr.colspan]="12"> ESF </th>
    </ng-container>

    <!--<ng-container matColumnDef="header-row-reference-comment">
      <th mat-header-cell *matHeaderCellDef [style.text-align]="center" [attr.rowspan]="2"> Accountant comment </th>
    </ng-container>

    <ng-container matColumnDef="header-row-reconcile-comment">
      <th mat-header-cell *matHeaderCellDef [style.text-align]="center" [attr.rowspan]="2"> Reconcile Comment </th>
    </ng-container>-->

    <tr mat-header-row *matHeaderRowDef="['header-row-jde-group', 'header-row-esf-group']"></tr>
    <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>

    <tr mat-row *matRowDef="let element; columns: columnsToDisplay;" class="example-element-row"
        [class.example-expanded-row]="element.expanded"
        (click)="element.expanded = !element.expanded"
        [class.reconciled]='element.reconciliationStatus == ArReconciliationStatusesEnum[ArReconciliationStatusesEnum.Reconciled]'
        [class.nonReconciled]='element.reconciliationStatus == ArReconciliationStatusesEnum[ArReconciliationStatusesEnum.NotReconciled]'
        [class.noMatch]='element.reconciliationStatus == ArReconciliationStatusesEnum[ArReconciliationStatusesEnum.NoMatch]'
        [hidden]="dataSource.loading | async">

    </tr>
    <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row" [hidden]="dataSource.loading | async">
    </tr>

  </table>  

  <app-loading *ngIf="dataSource.loading | async" [widthPx]='100'></app-loading>
  
</div>



